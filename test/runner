'use strict';

var Nodeunit = require('nodeunit');
var glob = require('glob');
var tests = glob.sync('test/common/**/*.js');

function supports () {

    try {
        eval('(function * () {})');

        return true;
    } catch (ex) {

        return false;
    }
}

if ( supports() ) {
    tests = tests.concat( glob.sync('test/harmony/**/*.js') );
}

process.on('uncaughtException', function (er) {

    if ( er instanceof Error ) {
        er = er.stack;
    }

    console.error(er);

    process.exit(1);
});

Nodeunit.reporters.default.run(tests, null, function (error) {

    if ( error ) {
        process.exit(1);

        return;
    }

    process.exit(0);
});
